name: Blog CI

on: [push, pull_request]

jobs:
  #Test's job
  # tests:
  #   name: Test
  #   runs-on: ubuntu-latest

  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: Set up JDK 8
  #       uses: actions/setup-java@v2
  #       with:
  #         java-version: '8'
  #         distribution: 'adopt'
  #     - name: Build with Maven
  #       run: mvn --batch-mode --update-snapshots verify
  #       working-directory: icwblog
  #     - name: Generate JaCoCo Badge
  #       id: jacoco
  #       uses: cicirello/jacoco-badge-generator@v2
  #       with:
  #         jacoco-csv-file: >
  #           icwblog/target/jacoco/test/jacoco.csv
  #           icwblog/target/jacoco/integrationTest/jacoco.csv
  #     - name: Log coverage percentage
  #       run: |
  #         echo "coverage = ${{ steps.jacoco.outputs.coverage }}"
  #         echo "branch coverage = ${{ steps.jacoco.outputs.branches }}"
  #     - name: Commit the badge (if it changed)
  #       run: |
  #         if [[ `git status --porcelain` ]]; then
  #           git config --global user.name 'Dong Duong'
  #           git config --global user.email 'dhdong1510@gmail.com'
  #           git add -A
  #           git commit -m "Autogenerated JaCoCo coverage badge"
  #           git push
  #         fi
  #Build's job
  build:
    #Depends on test's job
    #needs: tests
    name: Build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Set up JDK 8
        uses: actions/setup-java@v2
        with:
          java-version: '8'
          distribution: 'adopt'
      - name: Build with Maven
        run: mvn -B package -DskipTests --file pom.xml
        working-directory: icwblog
      - name: ssh-scp-deploy
        uses: marcodallasanta/ssh-scp-deploy@v1.1.0
        with:
          local: 'icwblog/target/icwblog-0.0.1-SNAPSHOT.jar'
          remote: ${{secrets.SSH_TARGET}}
          host: ${{secrets.SERVER_IP_ADDRESS}}
          user: ${{secrets.SERVER_USERNAME}}
          password: ${{secrets.SERVER_PASSWORD}}
